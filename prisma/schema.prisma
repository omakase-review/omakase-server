generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["interactiveTransactions", "filteredRelationCount"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model User {
  id Int @id @db.UnsignedInt @default(autoincrement())
  email String @db.VarChar(100) @unique
  name String? @db.VarChar(100)

  reviews Review[]
  comments Comments[]
  favorites Favorites[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt        DateTime?         @map("updated_at")
  deletedAt        DateTime?         @map("deleted_at")

  @@map("users")
}

model Restaurant {
  id Int @id @db.UnsignedInt @default(autoincrement())
  name String? @db.VarChar(100)
  address String? @db.VarChar(100)
  gu String? @db.VarChar(10)
  lunchPrice Int? @db.UnsignedInt @map("lunch_price")
  dinnerPrice Int? @db.UnsignedInt @map("dinner_price")
  corkCharge String? @db.VarChar(100) @map("cork_charge")

  reviews Review[]
  image String? @db.VarChar(300)
  dayOff String? @db.VarChar(100) @map("day_off")
  
  phoneNumber String? @db.VarChar(100) @map("phone_number")
  openingHours String? @db.VarChar(100) @map("opening_hours")
  parking Boolean? @default(false)
  snss Sns[]

  openedAt DateTime? @map("opened_at")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt        DateTime?         @map("updated_at")
  deletedAt        DateTime?         @map("deleted_at")

  @@map("restaurants")
}

model Sns {
  id Int @id @db.UnsignedInt @default(autoincrement())
  owner Restaurant @relation(fields: [ownerId], references: [id])
  ownerId Int @db.UnsignedInt @map("owner_id")

  link String @db.VarChar(100)

  @@map("snss")
}
model Review {
  id Int @id @db.UnsignedInt @default(autoincrement())
  score Decimal @db.Decimal(2, 1)
  title String @db.VarChar(20)
  description String @db.VarChar(100)

  serviceStatus ServiceStatus? @default(NOMAL) @map("service_status")
  tasteStatus TasteStatus? @default(NOMAL) @map("taste_status")
  revisitStatus RevisitStatus? @default(SOSO) @map("revisit_status")
  images Images[]
  favorites Favorites[]
  comments Comments[]

  user User @relation(fields: [userId], references: [id])
  userId Int @db.UnsignedInt @map("user_id")

  restaurant Restaurant @relation(fields: [restaurantId], references: [id])
  restaurantId Int @db.UnsignedInt @map("restaurant_id")
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt        DateTime?         @map("updated_at")
  deletedAt        DateTime?         @map("deleted_at")

  @@map("reviews")
}

model Favorites {
  id Int @id @db.UnsignedInt @default(autoincrement())

  user User @relation(fields: [userId], references: [id])
  userId Int @db.UnsignedInt @map("user_id")

  review Review @relation(fields: [reviewId], references: [id])
  reviewId Int @db.UnsignedInt @map("review_id")

  createdAt DateTime @default(now()) @map("created_at")

  @@unique([userId, reviewId])
  @@map("favorites")
}
model Comments {
  id Int @id @db.UnsignedInt @default(autoincrement())
  text String @db.VarChar(200)

  user User @relation(fields: [userId], references: [id])
  userId Int @db.UnsignedInt @map("user_id")

  review Review @relation(fields: [reviewId], references: [id])
  reviewId Int @db.UnsignedInt @map("review_id") 

  parentId Int? @db.UnsignedInt @map("parent_id")
  parent   Comments?   @relation("ReplyComments", fields: [parentId], references: [id])
  childs  Comments[]  @relation("ReplyComments")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt        DateTime?         @map("updated_at")
  deletedAt        DateTime?         @map("deleted_at")

  @@unique([userId, reviewId])
  @@map("comments")
}

model Images {
  id Int @id @db.UnsignedInt @default(autoincrement())
  url String @db.VarChar(200)

  review Review @relation(fields: [reviewId], references: [id])
  reviewId Int @db.UnsignedInt @map("review_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt        DateTime?         @map("updated_at")
  deletedAt        DateTime?         @map("deleted_at")

  @@map("images")
}

enum ServiceStatus {
  SOSO
  NOMAL
  GOOD
}
enum TasteStatus {
  SOSO
  NOMAL
  UMAI
}
enum RevisitStatus {
  NO
  SOSO
  YES
}